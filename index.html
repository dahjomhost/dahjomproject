<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dahjom Typing Tool for Students</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background shapes */
        .bg-shape {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s ease-in-out infinite;
        }

        .bg-shape:nth-child(1) {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
        }

        .bg-shape:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
            animation-duration: 25s;
            animation-direction: reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        /* Main Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Left Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 350px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            padding: 30px;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            z-index: 10;
        }

        .logo-section {
            text-align: center;
        }

        .logo-section h1 {
            font-size: 2.2em;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .user-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .user-card h3 {
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .user-card p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        /* Settings Panel */
        .settings-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 25px;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .settings-panel h3 {
            color: #5f27cd;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .setting-card {
            background: white;
            padding: 18px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .setting-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .setting-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(240, 147, 251, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .setting-card:hover::before {
            opacity: 1;
        }

        .setting-card .icon {
            font-size: 2.2em;
            margin-bottom: 8px;
            display: block;
        }

        .setting-card .setting-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            margin: 0 auto;
        }

        .toggle-switch input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .volume-control {
            margin-top: 5px;
        }

        .volume-slider {
            width: 100%;
            margin: 8px 0;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            cursor: pointer;
        }

        .volume-value {
            text-align: center;
            font-weight: 600;
            color: #f093fb;
        }

        /* Progress Section */
        .progress-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            background-image: linear-gradient(white, white), linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            background-origin: border-box;
            background-clip: padding-box, border-box;
        }

        .progress-label {
            font-size: 1.1em;
            color: #5f27cd;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
        }

        .stats-mini {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-mini {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-mini-label {
            font-size: 0.8em;
            color: #666;
        }

        .stat-mini-value {
            font-size: 1.2em;
            font-weight: 600;
            color: #5f27cd;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 30px 40px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-left: 350px;
            overflow-y: auto;
            min-height: 100vh;
        }

        /* Header Bar */
        .header-bar {
            background: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .difficulty-selector {
            display: flex;
            gap: 15px;
        }

        .difficulty-btn {
            padding: 12px 30px;
            background: white;
            border: 3px solid #e0e0e0;
            color: #333;
            cursor: pointer;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-color: transparent;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .btn-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-icon:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        /* Stats Display */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(240, 147, 251, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Typing Area */
        .typing-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .text-display {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 30px;
            border-radius: 15px;
            font-size: 1.5em;
            line-height: 2;
            min-height: 120px;
            max-height: 200px;
            overflow-y: auto;
            color: #2d3436;
            font-weight: 500;
        }

        .text-display .correct {
            color: #00b894;
            background-color: rgba(0, 184, 148, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .text-display .incorrect {
            color: #ff6b6b;
            background-color: rgba(255, 107, 107, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .text-display .current {
            background-color: #74b9ff;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .input-area {
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            outline: none;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-area:focus {
            border-color: #f093fb;
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.2);
        }

        .typing-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            padding: 15px 50px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(253, 121, 168, 0.4);
        }

        /* Keyboard */
        .keyboard-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .key {
            background: linear-gradient(135deg, #dfe6e9 0%, #b2bec3 100%);
            border: 2px solid #636e72;
            color: #2d3436;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.1s ease;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .key:active, .key.active {
            transform: translateY(2px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .key.correct-key {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            animation: correctBounce 0.3s ease;
        }

        @keyframes correctBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .key.incorrect-key {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            animation: shake 0.3s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .key.wide { min-width: 60px; }
        .key.extra-wide { min-width: 90px; }
        .key.space { min-width: 250px; }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: white;
            padding: 50px;
            border-radius: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalPop 0.3s ease-out;
            position: relative;
        }

        @keyframes modalPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        /* Floating Elements */
        .encouragement {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-size: 1.3em;
            font-weight: 600;
            color: #5f27cd;
            opacity: 0;
            transform: translateY(100px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .encouragement.show {
            opacity: 1;
            transform: translateY(0);
        }

        .ai-helper {
            position: fixed;
            bottom: 30px;
            left: 390px;
            right: 40px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideUp 0.5s ease-out;
            z-index: 50;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .ai-helper h4 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .ai-helper p {
            color: #333;
            font-size: 1em;
            margin: 0;
        }

        /* Desktop optimizations */
        @media (min-width: 1400px) {
            .sidebar {
                width: 380px;
            }
            .main-content {
                margin-left: 380px;
            }
            .ai-helper {
                left: 420px;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
            }
            .main-content {
                margin-left: 280px;
            }
            .ai-helper {
                left: 320px;
            }
            .stats-display {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
            .stats-display {
                grid-template-columns: 1fr;
            }
            .ai-helper {
                left: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-shape"></div>
    <div class="bg-shape"></div>

    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <h1></h1>Dahjom Typing</h1>
                <p style="color: #666; font-size: 0.9em;">Learn to Type Like a Pro!</p>
            </div>

            <div class="user-card" id="userCard" style="display: none;">
                <h3>üëã <span id="userName"></span></h3>
                <p>Age: <span id="userAge"></span></p>
            </div>

            <div class="settings-panel">
                <h3>‚öôÔ∏è Quick Settings</h3>
                <div class="settings-grid">
                    <div class="setting-card">
                        <span class="icon">üîä</span>
                        <span class="setting-label">Sounds</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <label class="toggle-slider" for="soundToggle"></label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <span class="icon">üó£Ô∏è</span>
                        <span class="setting-label">Voice</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="voiceToggle" checked>
                            <label class="toggle-slider" for="voiceToggle"></label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <span class="icon">ü§ñ</span>
                        <span class="setting-label">AI Helper</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="aiToggle">
                            <label class="toggle-slider" for="aiToggle"></label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <span class="icon">üéöÔ∏è</span>
                        <span class="setting-label">Volume</span>
                        <div class="volume-control">
                            <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider">
                            <div class="volume-value" id="volumeValue">50%</div>
                        </div>
                    </div>
                </div>

                <div class="voice-selector" style="margin-top: 20px;">
                    <h4 style="color: #5f27cd; margin-bottom: 15px; font-size: 1.1em;">üé§ Voice Selection</h4>
                    <select id="voiceSelect" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 0.95em; font-family: inherit; outline: none; cursor: pointer;">
                        <option value="">Default Voice</option>
                    </select>
                </div>

                <div class="fun-facts-toggle" style="margin-top: 15px;">
                    <div class="setting-card" style="width: 100%;">
                        <span class="icon">üí°</span>
                        <span class="setting-label">Fun Facts</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="funFactsToggle" checked>
                            <label class="toggle-slider" for="funFactsToggle"></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="progress-card">
                <div class="progress-label">üèÜ Daily Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="stats-mini">
                    <div class="stat-mini">
                        <div class="stat-mini-label">Tests</div>
                        <div class="stat-mini-value" id="totalTests">0</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-label">Best WPM</div>
                        <div class="stat-mini-value" id="bestWpm">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header-bar">
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy">üå± Easy</button>
                    <button class="difficulty-btn" data-level="medium">üåø Medium</button>
                    <button class="difficulty-btn" data-level="hard">üå≥ Hard</button>
                </div>

                <div class="action-buttons">
                    <button class="btn-icon" id="fullscreenBtn" title="Fullscreen">üñ•Ô∏è</button>
                    <button class="btn-icon" id="resetUserBtn" title="Change User">üë§</button>
                </div>
            </div>

            <div class="stats-display">
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-label">Time</div>
                    <div class="stat-value" id="time">60s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-label">Speed</div>
                    <div class="stat-value" id="wpm">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-label">Accuracy</div>
                    <div class="stat-value" id="accuracy">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ùå</div>
                    <div class="stat-label">Mistakes</div>
                    <div class="stat-value" id="errors">0</div>
                </div>
            </div>

            <div class="typing-section">
                <div class="text-display" id="textDisplay">
                    üéÆ Ready to start? Click the Start button below! üöÄ
                </div>

                <input type="text" class="input-area" id="inputArea" placeholder="Type here when ready... üí™" disabled>

                <div class="typing-controls">
                    <button class="btn btn-primary" id="startBtn">üéØ START</button>
                    <button class="btn btn-secondary" id="resetBtn">üîÑ RESET</button>
                </div>
            </div>

            <div class="keyboard-section">
                <div class="keyboard-row">
                    <div class="key" data-key="`">`</div>
                    <div class="key" data-key="1">1</div>
                    <div class="key" data-key="2">2</div>
                    <div class="key" data-key="3">3</div>
                    <div class="key" data-key="4">4</div>
                    <div class="key" data-key="5">5</div>
                    <div class="key" data-key="6">6</div>
                    <div class="key" data-key="7">7</div>
                    <div class="key" data-key="8">8</div>
                    <div class="key" data-key="9">9</div>
                    <div class="key" data-key="0">0</div>
                    <div class="key" data-key="-">-</div>
                    <div class="key" data-key="=">=</div>
                    <div class="key wide" data-key="Backspace">‚å´</div>
                </div>
                <div class="keyboard-row">
                    <div class="key wide" data-key="Tab">Tab</div>
                    <div class="key" data-key="q">Q</div>
                    <div class="key" data-key="w">W</div>
                    <div class="key" data-key="e">E</div>
                    <div class="key" data-key="r">R</div>
                    <div class="key" data-key="t">T</div>
                    <div class="key" data-key="y">Y</div>
                    <div class="key" data-key="u">U</div>
                    <div class="key" data-key="i">I</div>
                    <div class="key" data-key="o">O</div>
                    <div class="key" data-key="p">P</div>
                    <div class="key" data-key="[">[</div>
                    <div class="key" data-key="]">]</div>
                    <div class="key" data-key="\\">\</div>
                </div>
                <div class="keyboard-row">
                    <div class="key extra-wide" data-key="CapsLock">Caps</div>
                    <div class="key" data-key="a">A</div>
                    <div class="key" data-key="s">S</div>
                    <div class="key" data-key="d">D</div>
                    <div class="key" data-key="f">F</div>
                    <div class="key" data-key="g">G</div>
                    <div class="key" data-key="h">H</div>
                    <div class="key" data-key="j">J</div>
                    <div class="key" data-key="k">K</div>
                    <div class="key" data-key="l">L</div>
                    <div class="key" data-key=";">;</div>
                    <div class="key" data-key="'">'</div>
                    <div class="key extra-wide" data-key="Enter">Enter</div>
                </div>
                <div class="keyboard-row">
                    <div class="key extra-wide" data-key="Shift">Shift</div>
                    <div class="key" data-key="z">Z</div>
                    <div class="key" data-key="x">X</div>
                    <div class="key" data-key="c">C</div>
                    <div class="key" data-key="v">V</div>
                    <div class="key" data-key="b">B</div>
                    <div class="key" data-key="n">N</div>
                    <div class="key" data-key="m">M</div>
                    <div class="key" data-key=",">,</div>
                    <div class="key" data-key=".">.</div>
                    <div class="key" data-key="/">/</div>
                    <div class="key extra-wide" data-key="Shift">Shift</div>
                </div>
                <div class="keyboard-row">
                    <div class="key wide" data-key="Control">Ctrl</div>
                    <div class="key wide" data-key="Alt">Alt</div>
                    <div class="key space" data-key=" ">Space</div>
                    <div class="key wide" data-key="Alt">Alt</div>
                    <div class="key wide" data-key="Control">Ctrl</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Elements -->
    <div class="encouragement" id="encouragement"></div>
    
    <div class="ai-helper" id="aiHelper">
        <h4>ü§ñ AI Assistant</h4>
        <p id="aiHelperText">Keep your fingers on the home row keys (ASDF and JKL;) for best typing speed!</p>
    </div>

    <!-- Fun Fact Display -->
    <div class="fun-fact-display" id="funFactDisplay" style="position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #fff5b4 0%, #ffe082 100%); padding: 20px 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); max-width: 350px; display: none; animation: slideIn 0.5s ease-out; z-index: 100;">
        <h4 style="color: #f57c00; margin-bottom: 10px; font-size: 1.1em;">üí° Fun Fact!</h4>
        <p id="funFactText" style="color: #333; font-size: 0.95em; margin: 0;"></p>
    </div>

    <!-- Welcome Modal -->
    <div class="modal" id="welcomeModal">
        <div class="modal-content">
            <h2 style="font-size: 2.5em; margin-bottom: 25px; background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üéâ Welcome to Typing Adventure! üéâ</h2>
            <div style="margin-bottom: 25px; text-align: left;">
                <label style="display: block; margin-bottom: 10px; color: #5f27cd; font-weight: 600; font-size: 1.1em;">üë§ Your Name</label>
                <input type="text" id="nameInput" placeholder="Enter your awesome name!" style="width: 100%; padding: 15px; border: 3px solid #dfe6e9; border-radius: 15px; font-size: 1.1em; outline: none;">
            </div>
            <div style="margin-bottom: 25px; text-align: left;">
                <label style="display: block; margin-bottom: 10px; color: #5f27cd; font-weight: 600; font-size: 1.1em;">üéÇ Your Age</label>
                <select id="ageInput" style="width: 100%; padding: 15px; border: 3px solid #dfe6e9; border-radius: 15px; font-size: 1.1em; outline: none; font-family: inherit;">
                    <option value="">Select your age group</option>
                    <option value="5-7">5-7 years üßí</option>
                    <option value="8-10">8-10 years üë¶</option>
                    <option value="11-13">11-13 years üëß</option>
                    <option value="14-16">14-16 years üßë</option>
                    <option value="17+">17+ years üë®‚Äçüéì</option>
                </select>
            </div>
            <button class="btn btn-primary" id="welcomeSubmit" style="width: 100%;">üöÄ Let's Start!</button>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2 style="font-size: 2.5em; margin-bottom: 20px; background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üéä Amazing Job! üéä</h2>
            <div style="font-size: 3em; margin: 20px 0;">
                <span id="starRating"></span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 30px 0;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚ö°</div>
                    <div style="color: #666; font-size: 0.9em;">Speed</div>
                    <div style="font-size: 1.8em; font-weight: 700; color: #5f27cd;" id="finalWpm">0</div>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üéØ</div>
                    <div style="color: #666; font-size: 0.9em;">Accuracy</div>
                    <div style="font-size: 1.8em; font-weight: 700; color: #5f27cd;" id="finalAccuracy">0%</div>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚úçÔ∏è</div>
                    <div style="color: #666; font-size: 0.9em;">Characters</div>
                    <div style="font-size: 1.8em; font-weight: 700; color: #5f27cd;" id="totalChars">0</div>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚ùå</div>
                    <div style="color: #666; font-size: 0.9em;">Mistakes</div>
                    <div style="font-size: 1.8em; font-weight: 700; color: #5f27cd;" id="totalErrors">0</div>
                </div>
            </div>
            <div id="aiFeedback" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 15px; display: none;">
                <h3 style="color: #1976d2; margin-bottom: 10px;">ü§ñ AI Coach Says:</h3>
                <p id="aiFeedbackText" style="color: #333; font-size: 1.1em;"></p>
            </div>
            <button class="btn btn-primary" id="closeModal" style="width: 100%; margin-top: 20px;">üéÆ Play Again!</button>
        </div>
    </div>

    <script>
        // User data
        let userData = {
            name: '',
            age: '',
            totalTests: 0,
            bestWpm: 0
        };

        // Settings - API key is hardcoded and hidden from user
        let settings = {
            soundEnabled: true,
            volume: 50,
            voiceEnabled: true,
            aiEnabled: false,
            funFactsEnabled: true,
            selectedVoice: null,
            apiKey: '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'
        };

        // Typing test variables
        let currentText = "";
        let currentIndex = 0;
        let startTime = null;
        let timerInterval = null;
        let errors = 0;
        let totalErrors = 0;
        let correctChars = 0;
        let difficulty = 'easy';
        let timeLimit = 60;
        let isTestActive = false;
        let lastWordEnd = 0;
        let encouragementTimeout = null;

        // Sample texts
        const texts = {
            easy: [
                "The sun is bright today. Birds sing happy songs.",
                "I love to play games. My friends are very nice.",
                "Cats and dogs are pets. They make us smile.",
                "Books are fun to read. I learn new things."
            ],
            medium: [
                "Learning to type is like learning to ride a bicycle. Practice makes you better every single day.",
                "The rainbow appears after rain. It has seven beautiful colors that make everyone happy.",
                "Technology helps us connect with friends around the world. We can share stories and learn together."
            ],
            hard: [
                "Persistence is the key to mastering any skill. Every expert was once a beginner who refused to give up on their dreams.",
                "The journey of a thousand miles begins with a single step. Each keystroke you type brings you closer to becoming a typing master."
            ]
        };

        // Encouragement messages
        const encouragements = [
            "Great job! üåü",
            "You're amazing! üí™",
            "Keep it up! üöÄ",
            "Fantastic! üéâ",
            "Awesome typing! üëè",
            "You're on fire! üî•",
            "Brilliant! ‚ú®",
            "Super star! ‚≠ê"
        ];

        // Audio context
        let audioContext;
        let speechSynth = window.speechSynthesis;
        let availableVoices = [];
        let funFactInterval = null;

        // DOM elements
        const welcomeModal = document.getElementById('welcomeModal');
        const resultModal = document.getElementById('resultModal');
        const textDisplay = document.getElementById('textDisplay');
        const inputArea = document.getElementById('inputArea');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const progressFill = document.getElementById('progressFill');
        const encouragementDiv = document.getElementById('encouragement');
        const aiHelper = document.getElementById('aiHelper');

        // Initialize
        window.addEventListener('load', () => {
            loadUserData();
            loadSettings();
            updateProgress();
            updateUserDisplay();
            loadVoices();
            
            if (!userData.name) {
                welcomeModal.style.display = 'flex';
                speakWelcome();
            }
            
            // Start fun facts if enabled
            if (settings.funFactsEnabled) {
                startFunFacts();
            }
        });

        // Load user data
        function loadUserData() {
            const saved = localStorage.getItem('astoeUserData');
            if (saved) {
                userData = JSON.parse(saved);
            }
        }

        // Save user data
        function saveUserData() {
            localStorage.setItem('astoeUserData', JSON.stringify(userData));
        }

        // Update user display
        function updateUserDisplay() {
            if (userData.name) {
                document.getElementById('userCard').style.display = 'block';
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userAge').textContent = userData.age;
                document.getElementById('totalTests').textContent = userData.totalTests;
                document.getElementById('bestWpm').textContent = userData.bestWpm;
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = Math.min((userData.totalTests * 10), 100);
            progressFill.style.width = progress + '%';
            progressFill.textContent = progress + '%';
        }

        // Load settings
        function loadSettings() {
            const saved = localStorage.getItem('astoeTypingSettings');
            if (saved) {
                const savedSettings = JSON.parse(saved);
                // Merge saved settings but keep API key hidden
                settings.soundEnabled = savedSettings.soundEnabled ?? settings.soundEnabled;
                settings.volume = savedSettings.volume ?? settings.volume;
                settings.voiceEnabled = savedSettings.voiceEnabled ?? settings.voiceEnabled;
                settings.aiEnabled = savedSettings.aiEnabled ?? settings.aiEnabled;
                settings.funFactsEnabled = savedSettings.funFactsEnabled ?? settings.funFactsEnabled;
                settings.selectedVoice = savedSettings.selectedVoice ?? settings.selectedVoice;
            }
            applySettings();
        }

        // Save settings
        function saveSettings() {
            // Save settings without exposing API key
            const settingsToSave = {
                soundEnabled: settings.soundEnabled,
                volume: settings.volume,
                voiceEnabled: settings.voiceEnabled,
                aiEnabled: settings.aiEnabled,
                funFactsEnabled: settings.funFactsEnabled,
                selectedVoice: settings.selectedVoice
            };
            localStorage.setItem('astoeTypingSettings', JSON.stringify(settingsToSave));
        }

        // Apply settings to UI
        function applySettings() {
            document.getElementById('soundToggle').checked = settings.soundEnabled;
            document.getElementById('voiceToggle').checked = settings.voiceEnabled;
            document.getElementById('volumeSlider').value = settings.volume;
            document.getElementById('volumeValue').textContent = settings.volume + '%';
            document.getElementById('aiToggle').checked = settings.aiEnabled;
            document.getElementById('funFactsToggle').checked = settings.funFactsEnabled;
            
            if (settings.selectedVoice && availableVoices.length > 0) {
                document.getElementById('voiceSelect').value = settings.selectedVoice;
            }
        }

        // Speak welcome message
        function speakWelcome() {
            if (!speechSynth) return;
            const utterance = new SpeechSynthesisUtterance('Please apna naam add karo, aur saath mein age bhi, tabhi main aapko aage le jaaunga');
            utterance.lang = 'hi-IN';
            utterance.rate = 0.9;
            speechSynth.speak(utterance);
        }

        // Show encouragement
        function showEncouragement() {
            const message = encouragements[Math.floor(Math.random() * encouragements.length)];
            encouragementDiv.textContent = message;
            encouragementDiv.classList.add('show');
            
            clearTimeout(encouragementTimeout);
            encouragementTimeout = setTimeout(() => {
                encouragementDiv.classList.remove('show');
            }, 2000);
        }

        // Settings handlers
        document.getElementById('soundToggle').addEventListener('change', (e) => {
            settings.soundEnabled = e.target.checked;
            saveSettings();
        });

        document.getElementById('voiceToggle').addEventListener('change', (e) => {
            settings.voiceEnabled = e.target.checked;
            saveSettings();
        });

        document.getElementById('aiToggle').addEventListener('change', (e) => {
            settings.aiEnabled = e.target.checked;
            saveSettings();
            if (e.target.checked && isTestActive) {
                aiHelper.style.display = 'block';
            } else {
                aiHelper.style.display = 'none';
            }
        });

        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            settings.volume = parseInt(e.target.value);
            document.getElementById('volumeValue').textContent = settings.volume + '%';
            saveSettings();
        });

        document.getElementById('voiceSelect').addEventListener('change', (e) => {
            settings.selectedVoice = e.target.value === '' ? null : parseInt(e.target.value);
            saveSettings();
            // Test the voice
            speak('Testing voice!');
        });

        document.getElementById('funFactsToggle').addEventListener('change', (e) => {
            settings.funFactsEnabled = e.target.checked;
            saveSettings();
            if (e.target.checked) {
                startFunFacts();
            } else {
                stopFunFacts();
            }
        });

        // Welcome modal submit
        document.getElementById('welcomeSubmit').addEventListener('click', () => {
            const name = document.getElementById('nameInput').value.trim();
            const age = document.getElementById('ageInput').value;
            
            if (!name || !age) {
                alert('Please enter both name and age! üòä');
                return;
            }
            
            userData.name = name;
            userData.age = age;
            saveUserData();
            updateUserDisplay();
            welcomeModal.style.display = 'none';
            
            // Speak greeting
            const utterance = new SpeechSynthesisUtterance(`Welcome ${name}! Let's have fun typing!`);
            speechSynth.speak(utterance);
        });

        // Reset user button
        document.getElementById('resetUserBtn').addEventListener('click', () => {
            if (confirm('Change user? This will reset your progress.')) {
                userData = { name: '', age: '', totalTests: 0, bestWpm: 0 };
                saveUserData();
                location.reload();
            }
        });

        // Fullscreen button
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // Close result modal
        document.getElementById('closeModal').addEventListener('click', () => {
            resultModal.style.display = 'none';
            resetTest();
        });

        // Difficulty selection
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (!isTestActive) {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    difficulty = btn.dataset.level;
                }
            });
        });

        // Initialize audio
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Play key sound
        function playKeySound(frequency = 800, duration = 50) {
            if (!settings.soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            gainNode.gain.value = (settings.volume / 100) * 0.1;
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // Load available voices
        function loadVoices() {
            availableVoices = speechSynth.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';
            
            // Group voices by language
            const voicesByLang = {};
            availableVoices.forEach((voice, index) => {
                const lang = voice.lang.split('-')[0];
                if (!voicesByLang[lang]) voicesByLang[lang] = [];
                voicesByLang[lang].push({ voice, index });
            });
            
            // Add voices to select
            Object.keys(voicesByLang).forEach(lang => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = lang.toUpperCase();
                
                voicesByLang[lang].forEach(({ voice, index }) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    optgroup.appendChild(option);
                });
                
                voiceSelect.appendChild(optgroup);
            });
            
            // Set saved voice if available
            if (settings.selectedVoice !== null) {
                voiceSelect.value = settings.selectedVoice;
            }
        }

        // Voice change event
        speechSynth.onvoiceschanged = loadVoices;

        // Speak text
        function speak(text, lang = 'en-US') {
            if (!settings.voiceEnabled || !speechSynth) return;
            
            speechSynth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Use selected voice if available
            if (settings.selectedVoice !== null && availableVoices[settings.selectedVoice]) {
                utterance.voice = availableVoices[settings.selectedVoice];
            } else {
                utterance.lang = lang;
            }
            
            utterance.rate = 1.0;
            utterance.volume = settings.volume / 100;
            speechSynth.speak(utterance);
        }

        // AI API call
        async function callAI(prompt) {
            if (!settings.aiEnabled || !settings.apiKey) return null;
            
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${settings.apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: 'You are a friendly typing tutor for kids. Be encouraging and fun!' },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 150
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (error) {
                console.error('AI error:', error);
            }
            return null;
        }

        // Get text for typing
        async function getTypingText() {
            if (settings.aiEnabled) {
                const aiText = await callAI(`Generate a fun ${difficulty} typing practice sentence for kids (${difficulty === 'easy' ? '10-15' : difficulty === 'medium' ? '20-30' : '40-50'} words).`);
                if (aiText) return aiText;
            }
            
            const textArray = texts[difficulty];
            return textArray[Math.floor(Math.random() * textArray.length)];
        }

        // Display text
        function displayText() {
            textDisplay.innerHTML = currentText.split('').map((char, index) => {
                let className = '';
                if (index < currentIndex) {
                    className = inputArea.value[index] === char ? 'correct' : 'incorrect';
                } else if (index === currentIndex) {
                    className = 'current';
                }
                return `<span class="${className}">${char}</span>`;
            }).join('');
        }

        // Start test
        async function startTest() {
            if (isTestActive) return;
            
            initAudio();
            
            textDisplay.innerHTML = '‚è≥ Loading awesome text...';
            currentText = await getTypingText();
            currentIndex = 0;
            errors = 0;
            totalErrors = 0;
            correctChars = 0;
            lastWordEnd = 0;
            startTime = Date.now();
            isTestActive = true;
            
            inputArea.value = '';
            inputArea.disabled = false;
            inputArea.focus();
            
            displayText();
            startTimer();
            
            startBtn.textContent = '‚è±Ô∏è TYPING...';
            startBtn.disabled = true;
            
            // Speak the paragraph when it appears
            speak(currentText);
            
            // Show AI helper if enabled
            if (settings.aiEnabled) {
                aiHelper.style.display = 'block';
                updateAIHelper('Remember to keep your fingers on the home row keys! You got this! üí™');
            }
        }

        // Update AI helper text
        async function updateAIHelper(text) {
            document.getElementById('aiHelperText').textContent = text;
        }

        // Start timer
        function startTimer() {
            let timeLeft = timeLimit;
            updateTimer(timeLeft);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer(timeLeft);
                updateStats();
                
                if (timeLeft <= 0 || currentIndex >= currentText.length) {
                    endTest();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimer(time) {
            document.getElementById('time').textContent = time + 's';
        }

        // Update stats
        function updateStats() {
            if (!startTime) return;
            
            const timeElapsed = (Date.now() - startTime) / 1000 / 60;
            const wordsTyped = correctChars / 5;
            const wpm = Math.round(wordsTyped / timeElapsed) || 0;
            const accuracy = currentIndex > 0 ? Math.round((correctChars / currentIndex) * 100) : 100;
            
            document.getElementById('wpm').textContent = wpm;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('errors').textContent = errors;
        }

        // End test
        async function endTest() {
            isTestActive = false;
            clearInterval(timerInterval);
            inputArea.disabled = true;
            startBtn.textContent = 'üéØ START';
            startBtn.disabled = false;
            
            // Hide AI helper
            aiHelper.style.display = 'none';
            
            // Update user data
            userData.totalTests++;
            const wpm = parseInt(document.getElementById('wpm').textContent);
            if (wpm > userData.bestWpm) {
                userData.bestWpm = wpm;
            }
            saveUserData();
            updateProgress();
            updateUserDisplay();
            
            // Calculate stars
            const accuracy = parseInt(document.getElementById('accuracy').textContent);
            let stars = '';
            if (accuracy >= 95) stars = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
            else if (accuracy >= 85) stars = '‚≠ê‚≠ê‚≠ê‚≠ê';
            else if (accuracy >= 75) stars = '‚≠ê‚≠ê‚≠ê';
            else if (accuracy >= 65) stars = '‚≠ê‚≠ê';
            else stars = '‚≠ê';
            
            // Update results
            document.getElementById('starRating').textContent = stars;
            document.getElementById('finalWpm').textContent = wpm;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('totalChars').textContent = currentIndex;
            document.getElementById('totalErrors').textContent = totalErrors;
            
            // Get AI feedback
            if (settings.aiEnabled) {
                const feedback = await callAI(`Kid completed typing: ${wpm} WPM, ${accuracy}% accuracy. Give fun, encouraging feedback with emojis!`);
                if (feedback) {
                    document.getElementById('aiFeedback').style.display = 'block';
                    document.getElementById('aiFeedbackText').textContent = feedback;
                }
            }
            
            resultModal.style.display = 'flex';
        }

        // Reset test
        function resetTest() {
            isTestActive = false;
            clearInterval(timerInterval);
            currentText = "";
            currentIndex = 0;
            errors = 0;
            totalErrors = 0;
            correctChars = 0;
            startTime = null;
            
            inputArea.value = '';
            inputArea.disabled = true;
            textDisplay.innerHTML = "üéÆ Ready to start? Click the Start button below! üöÄ";
            
            document.getElementById('time').textContent = '60s';
            document.getElementById('wpm').textContent = '0';
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('errors').textContent = '0';
            
            startBtn.textContent = 'üéØ START';
            startBtn.disabled = false;
            
            aiHelper.style.display = 'none';
            
            // Clear keyboard highlights
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('active', 'correct-key', 'incorrect-key');
            });
        }

        // Highlight key
        function highlightKey(key, isCorrect) {
            const keyElements = document.querySelectorAll('.key');
            keyElements.forEach(keyEl => {
                const keyData = keyEl.getAttribute('data-key');
                if (keyData === key.toLowerCase() || keyData === key) {
                    keyEl.classList.add('active');
                    if (isCorrect) {
                        keyEl.classList.add('correct-key');
                    } else {
                        keyEl.classList.add('incorrect-key');
                    }
                    setTimeout(() => {
                        keyEl.classList.remove('active', 'correct-key', 'incorrect-key');
                    }, 200);
                }
            });
        }

        // Input handler
        inputArea.addEventListener('input', (e) => {
            const typedValue = e.target.value;
            const typedChar = typedValue[typedValue.length - 1];
            
            if (typedValue.length < currentIndex) {
                currentIndex = typedValue.length;
            } else if (typedChar === currentText[currentIndex]) {
                correctChars++;
                currentIndex++;
                highlightKey(typedChar, true);
                
                // Show encouragement every 10 correct chars
                if (correctChars % 10 === 0) {
                    showEncouragement();
                }
                
                // Check if word completed
                if (currentText[currentIndex] === ' ' || currentIndex === currentText.length) {
                    const word = currentText.substring(lastWordEnd, currentIndex).trim();
                    if (word) {
                        speak(word);
                    }
                    lastWordEnd = currentIndex + 1;
                }
            } else {
                errors++;
                totalErrors++;
                currentIndex++;
                highlightKey(typedChar || currentText[currentIndex - 1], false);
                playKeySound(300, 100);
                
                // AI helper for errors
                if (settings.aiEnabled && errors % 5 === 0) {
                    const missedChar = currentText[currentIndex - 1];
                    updateAIHelper(`Try to slow down a bit! The letter '${missedChar}' is on the ${getFingerHint(missedChar)} üòä`);
                }
            }
            
            displayText();
            updateStats();
            
            if (currentIndex >= currentText.length) {
                endTest();
            }
        });

        // Get finger hint
        function getFingerHint(char) {
            const fingerMap = {
                'a': 'left pinky', 's': 'left ring finger', 'd': 'left middle finger', 'f': 'left index finger',
                'j': 'right index finger', 'k': 'right middle finger', 'l': 'right ring finger', ';': 'right pinky',
                ' ': 'thumb (space bar)'
            };
            return fingerMap[char.toLowerCase()] || 'keyboard';
        }

        // Keyboard events
        document.addEventListener('keydown', (e) => {
            if (isTestActive && e.key.length === 1) {
                playKeySound(800 + Math.random() * 400, 50);
            }
        });

        // Prevent paste
        inputArea.addEventListener('paste', (e) => {
            e.preventDefault();
        });

        // Button events
        startBtn.addEventListener('click', startTest);
        resetBtn.addEventListener('click', resetTest);

        // Close modals on outside click
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                if (e.target.id !== 'welcomeModal' || userData.name) {
                    e.target.style.display = 'none';
                }
            }
        });

        // Fun facts functions
        async function showFunFact() {
            if (!settings.funFactsEnabled || !settings.aiEnabled) return;
            
            const fact = await callAI('Generate a fun, educational fact for kids about typing, computers, or learning. Keep it short and interesting with an emoji!');
            if (fact) {
                const funFactDisplay = document.getElementById('funFactDisplay');
                const funFactText = document.getElementById('funFactText');
                funFactText.textContent = fact;
                funFactDisplay.style.display = 'block';
                
                // Speak the fun fact
                speak(fact);
                
                // Hide after 10 seconds
                setTimeout(() => {
                    funFactDisplay.style.display = 'none';
                }, 10000);
            }
        }

        function startFunFacts() {
            // Show a fun fact immediately
            showFunFact();
            
            // Then show one every 2 minutes
            funFactInterval = setInterval(showFunFact, 120000);
        }

        function stopFunFacts() {
            if (funFactInterval) {
                clearInterval(funFactInterval);
                funFactInterval = null;
            }
            document.getElementById('funFactDisplay').style.display = 'none';
        }

        // Initialize
        resetTest();
    </script>
</body>
</html>


